<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.lhiot.dc.mapper.ProductShelfMapper">
    <!-- 数据库字段对象关系映射 -->
    <resultMap id="baseResultMap" type="com.lhiot.dc.domain.ProductShelf">
        <id column="id" property="id"/>
        <result column="name" property="name"/>
        <result column="specification_id" property="specificationId"/>
        <result column="shelf_qty" property="shelfQty"/>
        <result column="price" property="price"/>
        <result column="description" property="description"/>
        <result column="shelf_status" property="shelfStatus"/>
        <result column="application_type" property="applicationType"/>
        <result column="sorting" property="sorting"/>
        <result column="image" property="image"/>
        <result column="create_at" property="createAt"/>
        <result column="original_price" property="originalPrice"/>
        <result column="product_image" property="productImage"/>
        <result column="shelf_type" property="shelfType"/>
    </resultMap>


    <!-- base查询字段  -->
    <sql id="columns">
        <trim suffixOverrides=",">
            id,
            `name`,
            specification_id,
            shelf_qty,
            price,
            description,
            shelf_status,
            application_type,
            sorting,
            image,
            create_at,
            original_price,
            product_image,
            shelf_type,
        </trim>
    </sql>


    <!--新增商品上架-->
    <insert id="insert" parameterType="com.lhiot.dc.domain.ProductShelf" useGeneratedKeys="true" keyColumn="id"
            keyProperty="id">
        insert into product_shelf
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="name != null ">
                `name`,
            </if>
            <if test="specificationId != null ">
                specification_id,
            </if>
            <if test="shelfQty != null ">
                shelf_qty,
            </if>
            <if test="price != null ">
                price,
            </if>
            <if test="description != null ">
                description,
            </if>
            <if test="shelfStatus != null ">
                shelf_status,
            </if>
            <if test="applicationType != null ">
                application_type,
            </if>
            <if test="sorting != null ">
                sorting,
            </if>
            <if test="image != null ">
                image,
            </if>
            <if test="createAt != null ">
                create_at,
            </if>
            <if test="originalPrice != null ">
                original_price,
            </if>
            <if test="productImage != null ">
                product_image,
            </if>
            <if test="shelfType != null ">
                shelf_type,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="name != null ">
                #{name},
            </if>
            <if test="specificationId != null ">
                #{specificationId},
            </if>
            <if test="shelfQty != null ">
                #{shelfQty},
            </if>
            <if test="price != null ">
                #{price},
            </if>
            <if test="description != null ">
                #{description},
            </if>
            <if test="shelfStatus != null ">
                #{shelfStatus},
            </if>
            <if test="applicationType != null ">
                #{applicationType},
            </if>
            <if test="sorting != null ">
                #{sorting},
            </if>
            <if test="image != null ">
                #{image},
            </if>
            <if test="createAt != null ">
                #{createAt},
            </if>
            <if test="originalPrice != null ">
                #{originalPrice},
            </if>
            <if test="productImage != null ">
                #{productImage},
            </if>
            <if test="shelfType != null ">
                #{shelfType},
            </if>
        </trim>
    </insert>

    <!--修改商品上架-->
    <update id="update" parameterType="com.lhiot.dc.domain.ProductShelf">
        update product_shelf
        <trim prefix="set" suffixOverrides=",">
            <if test="name != null and name != ''">`name` = #{name},</if>
            <if test="specificationId != null and specificationId != ''">specification_id = #{specificationId},</if>
            <if test="shelfQty != null and shelfQty != ''">shelf_qty = #{shelfQty},</if>
            <if test="price != null and price != ''">price = #{price},</if>
            <if test="originalPrice != null and originalPrice != ''">original_price = #{originalPrice},</if>
            <if test="image != null and image != ''">image = #{image},</if>
            <if test="productImage != null and productImage != ''">product_image = #{productImage},</if>
            <if test="shelfStatus != null and shelfStatus != ''">shelf_status = #{shelfStatus},</if>
            <if test="shelfType != null and shelfType != ''">shelf_type = #{shelfType},</if>
            <if test="description != null and description != ''">description = #{description},</if>
            <if test="sorting != null and sorting != ''">sorting = #{sorting},</if>
            <if test="applicationType != null and applicationType != ''">application_type = #{applicationType},</if>
            <if test="createAt != null">create_at = #{createAt},</if>
        </trim>
        where id = #{id}
    </update>


    <!-- 查找单个商品上架 -->
    <select id="findById" parameterType="Long" resultMap="baseResultMap">
        select
        <include refid="columns"/>
        from product_shelf where id=#{0}
    </select>


    <!--根据商品规格Id查询商品上架集合-->
    <select id="findListBySpecificationId" resultMap="baseResultMap" parameterType="Long">
        select
        <include refid="columns"/>
        from product_shelf
        where specification_id = #{0}
    </select>


    <!--根据商品Id查询商品上架集合-->
    <select id="findListByProductId" resultMap="baseResultMap" parameterType="Long">
        select
        <include refid="columns"/>
        from product_shelf
        where specification_id in (select ps.id from product_specification ps where ps.product_id = #{0})
    </select>


</mapper>